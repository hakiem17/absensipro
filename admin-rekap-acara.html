<!DOCTYPE html>
<html lang="id" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rekap Acara Live - Admin Panel</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap");

      /* --- MODERN CSS VARIABLES --- */
      :root {
        --sidebar-w: 280px;
        --header-h: 70px;
        --border-radius: 12px;
        --border-radius-lg: 16px;
        --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --gradient-warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        --gradient-info: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      }

      :root[data-theme="light"] {
        --bg-main: #f8fafc;
        --bg-sidebar: #ffffff;
        --bg-card: #ffffff;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --text-muted: #94a3b8;
        --border-color: #e2e8f0;
        --border-hover: #cbd5e1;
        --nav-link-hover-bg: #f1f5f9;
        --nav-link-active-bg: #eff6ff;
        --nav-link-active-color: #3b82f6;
        --header-bg: #ffffff;
        --footer-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      :root[data-theme="dark"] {
        --bg-main: #0f172a;
        --bg-sidebar: #1e293b;
        --bg-card: #334155;
        --text-primary: #f8fafc;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --border-color: #475569;
        --border-hover: #64748b;
        --nav-link-hover-bg: rgba(255, 255, 255, 0.05);
        --nav-link-active-bg: rgba(59, 130, 246, 0.1);
        --nav-link-active-color: #60a5fa;
        --header-bg: #1e293b;
        --footer-bg: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      }

      /* --- MODERN RESET & BASE --- */
      * {
        box-sizing: border-box;
      }

      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      body {
        background-color: var(--bg-main);
        color: var(--text-primary);
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        font-size: 14px;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* --- MODERN LAYOUT SYSTEM --- */
      .main-wrapper {
        display: grid;
        grid-template-columns: 0 1fr;
        grid-template-rows: var(--header-h) 1fr auto;
        grid-template-areas: 
          "sidebar header"
          "sidebar main"
          "sidebar footer";
        min-height: 100vh;
        transition: var(--transition);
      }

      @media (min-width: 992px) {
        .main-wrapper {
          grid-template-columns: var(--sidebar-w) 1fr;
        }
      }

      /* --- MODERN SIDEBAR --- */
      .sidebar {
        grid-area: sidebar;
        background: var(--bg-sidebar);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: var(--sidebar-w);
        z-index: 1000;
        transform: translateX(-100%);
        transition: var(--transition);
        box-shadow: var(--shadow-lg);
      }

      @media (min-width: 992px) {
        .sidebar {
          position: static;
          transform: translateX(0);
          box-shadow: none;
        }
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .sidebar-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .sidebar-brand {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-primary);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .sidebar-brand i {
        font-size: 1.5rem;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .sidebar-nav {
        flex: 1;
        padding: 1rem 0;
        overflow-y: auto;
      }

      .nav-item {
        margin: 0.25rem 0;
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1.5rem;
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.875rem;
        border-radius: 0;
        transition: var(--transition);
        position: relative;
      }

      .nav-link:hover {
        background: var(--nav-link-hover-bg);
        color: var(--text-primary);
        transform: translateX(4px);
      }

      .nav-link.active {
        background: var(--nav-link-active-bg);
        color: var(--nav-link-active-color);
        font-weight: 600;
      }

      .nav-link.active::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: var(--nav-link-active-color);
        border-radius: 0 2px 2px 0;
      }

      .nav-link i {
        font-size: 1.125rem;
        width: 20px;
        text-align: center;
      }

      .sidebar-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid var(--border-color);
      }

      /* --- MODERN HEADER --- */
      .top-header {
        grid-area: header;
        background: var(--header-bg);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1.5rem;
        height: var(--header-h);
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .sidebar-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border: none;
        background: var(--bg-card);
        color: var(--text-secondary);
        border-radius: var(--border-radius);
        transition: var(--transition);
        cursor: pointer;
      }

      .sidebar-toggle:hover {
        background: var(--nav-link-hover-bg);
        color: var(--text-primary);
      }

      @media (min-width: 992px) {
        .sidebar-toggle {
          display: none;
        }
      }

      .header-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .theme-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border: none;
        background: var(--bg-card);
        color: var(--text-secondary);
        border-radius: var(--border-radius);
        transition: var(--transition);
        cursor: pointer;
      }

      .theme-toggle:hover {
        background: var(--nav-link-hover-bg);
        color: var(--text-primary);
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      /* --- MODERN MAIN CONTENT --- */
      .main-content-wrapper {
        grid-area: main;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .main-content {
        flex: 1;
        padding: 2rem;
        overflow-y: auto;
      }

      @media (max-width: 768px) {
        .main-content {
          padding: 1rem;
        }
      }

      /* --- MODERN TOOLBAR --- */
      .toolbar-container {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow-sm);
      }

      .toolbar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .toolbar-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
      }

      .form-select {
        background: var(--bg-main);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 0.75rem;
        font-size: 0.875rem;
        transition: var(--transition);
      }

      .form-select:focus {
        outline: none;
        border-color: var(--nav-link-active-color);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      /* --- MODERN LIVE DISPLAY --- */
      .live-display-container {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        position: relative;
        min-height: 500px;
      }

      .live-header {
        background: var(--gradient-primary);
        color: white;
        padding: 1.5rem;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .live-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        animation: shimmer 3s infinite;
      }

      @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
      }

      .live-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
        position: relative;
        z-index: 1;
      }

      .live-subtitle {
        font-size: 0.875rem;
        opacity: 0.9;
        margin: 0.5rem 0 0 0;
        position: relative;
        z-index: 1;
      }

      .live-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(255, 255, 255, 0.2);
        padding: 0.25rem 0.75rem;
        border-radius: var(--border-radius);
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
        z-index: 1;
      }

      .live-dot {
        width: 8px;
        height: 8px;
        background: #22c55e;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }


      /* --- MODERN SCROLLING TABLE --- */
      .table-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
      }

      .table-header {
        background: var(--nav-link-hover-bg);
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .table-header .table {
        margin: 0;
        table-layout: fixed;
      }

      .table-header .table th {
        background: var(--nav-link-hover-bg);
        color: var(--text-primary);
        font-weight: 600;
        font-size: 0.875rem;
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .table-body-scroll-container {
        flex: 1;
        overflow: hidden;
        position: relative;
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
      }


      .table-scroll-content {
        width: 100%;
        background: var(--bg-card);
        position: relative;
        animation: creditRoll 30s linear infinite;
      }

      @keyframes creditRoll {
        0% {
          transform: translateY(100%);
        }
        100% {
          transform: translateY(-100%);
        }
      }

      .table-scroll-content:hover {
        animation-play-state: paused;
      }

      /* Animation Control Buttons */
      #play-pause-btn, #restart-btn {
        border-radius: var(--border-radius);
        font-weight: 500;
        transition: var(--transition);
        padding: 0.75rem 1.5rem;
        font-size: 0.875rem;
      }

      #play-pause-btn {
        background: var(--gradient-primary);
        border: none;
        color: white;
      }

      #play-pause-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      #restart-btn {
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        background: transparent;
      }

      #restart-btn:hover {
        background: var(--nav-link-hover-bg);
        color: var(--text-primary);
        transform: translateY(-1px);
      }

      .table-scroll-content .table {
        margin: 0;
        table-layout: fixed;
        width: 100%;
        opacity: 1 !important;
        visibility: visible !important;
        background: var(--bg-card);
        border-collapse: collapse;
      }

      .table-scroll-content .table td {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: middle;
        background: var(--bg-card) !important;
        color: var(--text-primary) !important;
        opacity: 1 !important;
        visibility: visible !important;
        font-weight: 500;
        font-size: 0.875rem;
      }

      .table-scroll-content .table tbody {
        opacity: 1;
        visibility: visible;
      }

      .table-scroll-content .table tbody tr {
        transition: var(--transition);
        opacity: 1 !important;
        visibility: visible !important;
        background: var(--bg-card) !important;
      }

      .table-scroll-content .table tbody tr:nth-child(odd) {
        background: var(--bg-card) !important;
      }

      .table-scroll-content .table tbody tr:nth-child(even) {
        background: var(--bg-main) !important;
      }

      .table-scroll-content .table tbody tr:hover {
        background: var(--nav-link-hover-bg) !important;
      }

      .table-scroll-content .table tbody tr:nth-child(even) {
        background: var(--bg-main) !important;
      }

      [data-theme="dark"] .table-scroll-content .table tbody tr:nth-child(even) {
        background: var(--bg-main) !important;
      }


      /* --- MODERN FOOTER --- */
      .footer-professional {
        grid-area: footer;
        background: var(--footer-bg);
        color: #ffffff;
        padding: 1.5rem 2rem;
        text-align: center;
        font-size: 0.875rem;
      }

      .footer-divider {
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        margin: 1rem 0;
      }

      /* --- MODERN OVERLAY --- */
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: var(--transition);
      }

      .sidebar-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      @media (min-width: 992px) {
        .sidebar-overlay {
          display: none;
        }
      }

      /* --- MODERN UTILITIES --- */
      .text-gradient {
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* --- DARK MODE TEXT OVERRIDES --- */
      [data-theme="dark"] .text-secondary { 
        color: var(--text-secondary) !important; 
      }
      [data-theme="dark"] .text-muted { 
        color: var(--text-muted) !important; 
      }
    </style>
  </head>
  <body>
    <script>
      (function () {
        const t = localStorage.getItem("theme") || "dark";
        document.documentElement.setAttribute("data-theme", t);
      })();
    </script>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="main-wrapper">
      <!-- Modern Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <a href="#" class="sidebar-brand">
            <i class="bi bi-calendar-check"></i>
            <span>AbsensiPro</span>
          </a>
        </div>
        
        <nav class="sidebar-nav">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="admin-dashboard.html">
                <i class="bi bi-speedometer2"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="admin-manajemen-acara.html">
                <i class="bi bi-calendar-event"></i>
                <span>Manajemen Acara</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="admin-daftar-hadir.html">
                <i class="bi bi-people"></i>
                <span>Daftar Hadir</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#">
                <i class="bi bi-display"></i>
                <span>Rekap Acara (Live)</span>
              </a>
            </li>
          </ul>
        </nav>
        
        <div class="sidebar-footer">
          <button id="btn-logout" class="btn btn-outline-danger w-100">
            <i class="bi bi-box-arrow-right me-2"></i>
            Logout
          </button>
        </div>
      </aside>

      <!-- Main Content Area -->
      <div class="main-content-wrapper">
        <!-- Modern Header -->
        <header class="top-header">
          <div class="header-left">
            <button class="sidebar-toggle" id="sidebarToggle">
              <i class="bi bi-list"></i>
            </button>
            <h1 class="header-title">Rekap Acara Live</h1>
          </div>
          
          <div class="header-right">
            <button id="theme-toggle" class="theme-toggle">
              <i class="bi bi-sun-fill"></i>
            </button>
            <div class="user-info">
              <i class="bi bi-person-circle"></i>
              <span>Selamat datang, Hakiem</span>
            </div>
          </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
          <!-- Page Header -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
              <h2 class="h4 mb-1 text-gradient">Rekap Kehadiran Live</h2>
              <p class="text-muted mb-0">Tampilan real-time daftar kehadiran peserta</p>
            </div>
            <a href="admin-manajemen-acara.html" class="btn btn-outline-secondary">
              <i class="bi bi-arrow-left me-2"></i>
              Kembali
            </a>
          </div>

          <!-- Modern Toolbar -->
          <div class="toolbar-container">
            <div class="toolbar-header">
              <h3 class="toolbar-title">Pilih Acara</h3>
            </div>
            
            <div class="row g-3">
              <div class="col-md-8">
                <label for="event-select" class="form-label fw-bold">Pilih Acara untuk Ditampilkan:</label>
                <select id="event-select" class="form-select form-select-lg">
                  <option>Memuat daftar acara...</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Modern Live Display -->
          <div class="live-display-container">
            <div class="live-header">
              <div class="live-indicator">
                <div class="live-dot"></div>
                <span>Live</span>
              </div>
              <h2 id="event-title" class="live-title">Pilih Acara untuk Memulai</h2>
              <p class="live-subtitle">Daftar kehadiran akan ditampilkan secara real-time</p>
            </div>

            <!-- Modern Scrolling Table -->
            <div class="table-wrapper">
              <div class="table-header">
                <table class="table align-middle">
                  <colgroup>
                    <col style="width:72px" />
                    <col style="width:280px" />
                    <col style="width:220px" />
                    <col style="width:200px" />
                    <col style="width:160px" />
                    <col style="width:240px" />
                  </colgroup>
                  <thead>
                    <tr>
                      <th>No</th>
                      <th>Nama Lengkap</th>
                      <th>Instansi</th>
                      <th>Jabatan</th>
                      <th>Jenis Kelamin</th>
                      <th>Waktu Kehadiran</th>
                    </tr>
                  </thead>
                </table>
              </div>
              <div class="table-body-scroll-container" id="scroll-container">
                <div class="table-scroll-content" id="scroll-content">
                  <!-- Konten tabel dinamis akan dimasukkan di sini oleh JS -->
                </div>
              </div>
              
              <!-- Tombol kontrol animasi -->
              <div class="text-center mt-3">
                <button id="play-pause-btn" class="btn btn-primary me-2">
                  <i class="bi bi-pause-fill me-1"></i>
                  Pause
                </button>
                <button id="restart-btn" class="btn btn-outline-primary">
                  <i class="bi bi-arrow-clockwise me-1"></i>
                  Restart
                </button>
              </div>
            </div>


          </div>
        </main>

        <!-- Modern Footer -->
        <footer class="footer-professional">
          <div class="footer-divider"></div>
          <div class="text-center">
            &copy; <span id="copyright-year"></span> Diskominfo Hulu Sungai Tengah.
          </div>
        </footer>
      </div>
    </div>

    <!-- Libs -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/auth.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // --- Logika Dasar ---
        document.getElementById("copyright-year").textContent =
          new Date().getFullYear();
        const themeToggle = document.getElementById("theme-toggle");
        function updateIcon() {
          themeToggle.querySelector("i").className =
            document.documentElement.getAttribute("data-theme") === "dark"
              ? "bi bi-sun-fill"
              : "bi bi-moon-fill";
        }
        themeToggle.addEventListener("click", () => {
          const t =
            document.documentElement.getAttribute("data-theme") === "dark"
              ? "light"
              : "dark";
          document.documentElement.setAttribute("data-theme", t);
          localStorage.setItem("theme", t);
          updateIcon();
        });
        updateIcon();
        const sb = supabase.createClient(
          window.SUPABASE_URL,
          window.SUPABASE_ANON_KEY
        );
        AdminAuth.requireAdmin();
        document
          .getElementById("btn-logout")
          ?.addEventListener("click", (e) => {
            e.preventDefault();
            AdminAuth.logout();
          });

        // Modern Sidebar Toggle
        const sidebar = document.getElementById("sidebar");
        const sidebarToggle = document.getElementById("sidebarToggle");
        const sidebarOverlay = document.getElementById("sidebarOverlay");

        function toggleSidebar() {
          sidebar.classList.toggle("show");
          sidebarOverlay.classList.toggle("show");
          document.body.style.overflow = sidebar.classList.contains("show") ? "hidden" : "";
        }

        function hideSidebar() {
          sidebar.classList.remove("show");
          sidebarOverlay.classList.remove("show");
          document.body.style.overflow = "";
        }

        // Event listeners for modern sidebar
        sidebarToggle?.addEventListener("click", toggleSidebar);
        sidebarOverlay?.addEventListener("click", hideSidebar);
        
        // Close sidebar when clicking nav links (mobile)
        sidebar.querySelectorAll(".nav-link").forEach(link => {
          link.addEventListener("click", () => {
            if (window.innerWidth < 992) {
              hideSidebar();
            }
          });
        });

        // Close sidebar on escape key
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && sidebar.classList.contains("show")) {
            hideSidebar();
          }
        });

        // Handle window resize
        window.addEventListener("resize", () => {
          if (window.innerWidth >= 992) {
            hideSidebar();
          }
        });

        // --- Logika Halaman Rekap ---
        const $eventSelect = document.getElementById("event-select");
        const $eventTitle = document.getElementById("event-title");
        const $scrollContainer = document.getElementById("scroll-container");
        const $scrollContent = document.getElementById("scroll-content");
        const $playPauseBtn = document.getElementById("play-pause-btn");
        const $restartBtn = document.getElementById("restart-btn");

        // Debug: Check if elements are found
        console.log("DOM Elements found:");
        console.log("eventSelect:", $eventSelect);
        console.log("eventTitle:", $eventTitle);
        console.log("scrollContainer:", $scrollContainer);
        console.log("scrollContent:", $scrollContent);
        
        // Additional debug for scroll elements
        if ($scrollContainer) {
          console.log("Scroll container dimensions:", {
            clientHeight: $scrollContainer.clientHeight,
            offsetHeight: $scrollContainer.offsetHeight,
            scrollHeight: $scrollContainer.scrollHeight
          });
        }
        
        if ($scrollContent) {
          console.log("Scroll content initial state:", {
            clientHeight: $scrollContent.clientHeight,
            offsetHeight: $scrollContent.offsetHeight,
            scrollHeight: $scrollContent.scrollHeight,
            innerHTML: $scrollContent.innerHTML.length + " characters"
          });
        }

        let attendeesList = [];
        let activeChannel = null;
        let isAnimating = true;

        function genderLabel(g) {
          const v = (g || "").toLowerCase();
          if (v === "male") return "Laki-Laki";
          if (v === "female") return "Perempuan";
          return "";
        }

        function toggleAnimation() {
          if (isAnimating) {
            $scrollContent.style.animationPlayState = "paused";
            $playPauseBtn.innerHTML = '<i class="bi bi-play-fill me-1"></i>Play';
            isAnimating = false;
          } else {
            $scrollContent.style.animationPlayState = "running";
            $playPauseBtn.innerHTML = '<i class="bi bi-pause-fill me-1"></i>Pause';
            isAnimating = true;
          }
        }

        function restartAnimation() {
          $scrollContent.style.animation = "none";
          $scrollContent.offsetHeight; // Force reflow
          $scrollContent.style.animation = "creditRoll 30s linear infinite";
          $scrollContent.style.animationPlayState = "running";
          $playPauseBtn.innerHTML = '<i class="bi bi-pause-fill me-1"></i>Pause';
          isAnimating = true;
        }


        function renderScrollingList() {
          console.log("renderScrollingList called with", attendeesList.length, "attendees");
          
          if (!attendeesList || attendeesList.length === 0) {
            console.log("No attendees, showing waiting message");
            $scrollContent.innerHTML = `<table class="table"><tbody><tr><td colspan="6" class="text-center text-secondary py-5">Menunggu peserta...</td></tr></tbody></table>`;
            return;
          }

          console.log("Rendering attendees list");
          const normalOrderList = [...attendeesList].reverse();
          const rows = normalOrderList
            .map(
              (att, index) => `
                <tr>
                  <td style="width: 70px;">${index + 1}</td>
                  <td>${att.name || "-"}</td>
                  <td>${att.instansi || "-"}</td>
                  <td>${att.jabatan || "-"}</td>
                  <td>${genderLabel(att.gender) || "-"}</td>
                  <td>${att.ts ? new Date(att.ts).toLocaleString('id-ID') : '-'}</td>
                </tr>`
            )
            .join("");

          const colgroup = `
            <colgroup>
              <col style=\"width:72px\" />
              <col style=\"width:280px\" />
              <col style=\"width:220px\" />
              <col style=\"width:200px\" />
              <col style=\"width:160px\" />
              <col style=\"width:240px\" />
            </colgroup>`;
          
          const tableHTML = `<table class="table table-striped align-middle">${colgroup}<tbody>${rows}</tbody></table>`;
          console.log("Setting scroll content HTML");
          $scrollContent.innerHTML = tableHTML;
          
          // Ensure content is visible
          $scrollContent.style.opacity = "1";
          $scrollContent.style.visibility = "visible";
          $scrollContent.style.display = "";
          
          console.log("Attendees list rendered successfully");
        }

        function handleNewAttendee(newAttendee) {
          if (attendeesList.some((att) => att.id === newAttendee.id)) return;

          attendeesList.unshift(newAttendee);
          renderScrollingList();
        }

        async function loadRecapForEvent(eventId) {
          console.log("loadRecapForEvent called with eventId:", eventId);
          
          if (activeChannel) sb.removeChannel(activeChannel);
          if (!eventId) {
            console.log("No eventId, showing select message");
            $eventTitle.textContent = "Silakan pilih acara";
            if ($scrollContent) {
              $scrollContent.innerHTML = `<table class="table"><tbody><tr><td colspan="6" class="text-center text-secondary py-5">Pilih acara dari daftar di atas.</td></tr></tbody></table>`;
            }
            return;
          }

          console.log("Loading data for event:", eventId);
          if ($scrollContent) {
            $scrollContent.innerHTML = `<table class="table"><tbody><tr><td colspan="6" class="text-center text-secondary py-5">Memuat data...</td></tr></tbody></table>`;
          }
          
          try {
            const [eventRes, attendeesRes] = await Promise.all([
              sb.from("events").select("title").eq("id", eventId).single(),
              sb
                .from("attendees")
                .select("id, name, jabatan, instansi, gender, ts")
                .eq("event_id", eventId)
                .order("ts", { ascending: false }),
            ]);

            console.log("Event result:", eventRes);
            console.log("Attendees result:", attendeesRes);

            $eventTitle.textContent = eventRes.data
              ? `Rekap Kehadiran: ${eventRes.data.title}`
              : "Acara tidak ditemukan";
            attendeesList = attendeesRes.data || [];
            
            console.log(`Loaded ${attendeesList.length} attendees for event ${eventId}`);
            renderScrollingList();

            activeChannel = sb
              .channel(`recap-channel-${eventId}`)
              .on(
                "postgres_changes",
                {
                  event: "INSERT",
                  schema: "public",
                  table: "attendees",
                  filter: `event_id=eq.${eventId}`,
                },
                (payload) => {
                  console.log("New attendee received:", payload.new);
                  handleNewAttendee(payload.new);
                }
              )
              .subscribe();
          } catch (error) {
            console.error("Error loading recap data:", error);
            if ($scrollContent) {
              $scrollContent.innerHTML = `<table class="table"><tbody><tr><td colspan="6" class="text-center text-danger py-5">Error loading data: ${error.message}</td></tr></tbody></table>`;
            }
          }
        }

        async function main() {
          console.log("Main function started");
          
          // HANYA AMBIL ACARA DENGAN STATUS 'active' ATAU 'upcoming'
          const { data: events } = await sb
            .from("events")
            .select("id, title")
            .in("status", ["active", "upcoming"])
            .order("datetime", { ascending: false });

          console.log("Events loaded:", events);

          if (events) {
            if (events.length === 0) {
              $eventSelect.innerHTML = `<option value="">-- Tidak ada acara aktif --</option>`;
            } else {
              $eventSelect.innerHTML =
                `<option value="">-- Pilih Acara --</option>` +
                events
                  .map((e) => `<option value="${e.id}">${e.title}</option>`)
                  .join("");
            }

            const urlEventId = new URLSearchParams(window.location.search).get(
              "event"
            );
            if (urlEventId && events.some((e) => e.id === urlEventId)) {
              $eventSelect.value = urlEventId;
            }
            
            // Always show some content initially
            if ($scrollContent) {
              $scrollContent.innerHTML = `<table class="table"><tbody><tr><td colspan="6" class="text-center text-secondary py-5">Pilih acara untuk melihat daftar kehadiran</td></tr></tbody></table>`;
            }
            
            loadRecapForEvent($eventSelect.value);
          }
          $eventSelect.addEventListener("change", (e) =>
            loadRecapForEvent(e.target.value)
          );

          // Event listeners for animation controls
          $playPauseBtn?.addEventListener("click", toggleAnimation);
          $restartBtn?.addEventListener("click", restartAnimation);

        }
        main();
      });
    </script>
  </body>
</html>
