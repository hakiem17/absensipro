<!DOCTYPE html>
<html lang="id" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pilih Acara</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap");

      :root {
        --content-gutter-x: clamp(16px, 2.5vw, 28px);
      }

      /* Theme vars */
      :root[data-theme="light"] {
        --bg-main: #f8fafc;
        --card-bg: #ffffff;
        --text-primary: #0f172a;
        --text-secondary: #475569; /* slate-700 */
        --border-color: #e2e8f0;
        --hover: #f1f5f9;
        --pill-active: #dcfce7;
        --pill-active-text: #166534;
        --pill-upcoming: #e0f2fe;
        --pill-upcoming-text: #0369a1;
        /* Footer tokens */
        --footer-bg: #3b82f6;
        --footer-fg: #e5e7eb;
      }
      :root[data-theme="dark"] {
        --bg-main: #111827;
        --card-bg: #1f2937; /* lebih kontras */
        --text-primary: #f8fafc;
        --text-secondary: #cbd5e1; /* slate-300: jelas di dark */
        --border-color: #374151;
        --hover: #2b3546;
        --pill-active: #064e3b;
        --pill-active-text: #a7f3d0;
        --pill-upcoming: #0b3b5c;
        --pill-upcoming-text: #93c5fd;
        /* Footer tokens */
        --footer-bg: #3b82f6;
        --footer-fg: #e5e7eb;
      }

      html,
      body {
        height: 100%;
      }
      body {
        background: var(--bg-main);
        color: var(--text-primary);
        font-family: "Poppins", sans-serif;
        /* Sticky footer layout */
        display: flex;
        flex-direction: column;
      }
      main {
        flex: 1 1 auto;
      }

      .topbar {
        background: var(--card-bg);
        border-bottom: 1px solid var(--border-color);
      }
      .container-left {
        padding-left: var(--content-gutter-x);
        padding-right: var(--content-gutter-x);
        max-width: 1200px;
        margin: 0 auto;
      }

      .btn-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        background: transparent;
      }
      .btn-icon:hover {
        background: var(--hover);
      }

      .title-lg {
        font-weight: 700;
        letter-spacing: 0.2px;
      }
      .subtitle {
        color: var(--text-secondary);
      }

      .events-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
      }
      @media (min-width: 768px) {
        .events-grid {
          grid-template-columns: 1fr 1fr;
        }
      }
      @media (min-width: 1200px) {
        .events-grid {
          grid-template-columns: 1fr 1fr 1fr;
        }
      }

      .card {
        background: var(--card-bg);
        border-color: var(--border-color);
      }
      .event-title {
        font-weight: 700;
      }
      .event-meta {
        color: var(--text-secondary);
        font-size: 0.94rem;
      }
      .event-badge {
        padding: 0.25rem 0.55rem;
        border-radius: 9999px;
        font-weight: 600;
        font-size: 0.8rem;
      }
      .badge-active {
        background: var(--pill-active);
        color: var(--pill-active-text);
      }
      .badge-upcoming {
        background: var(--pill-upcoming);
        color: var(--pill-upcoming-text);
      }
      .event-card .bi {
        vertical-align: -0.15rem;
      }

      /* Footer seperti menu lain (bar biru) */
      .footer-bar {
        background: var(--footer-bg);
        color: var(--footer-fg);
        padding: 18px 0;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
      }
    </style>
  </head>
  <body>
    <script>
      // persist tema
      (function () {
        const t = localStorage.getItem("theme") || "dark";
        document.documentElement.setAttribute("data-theme", t);
      })();
    </script>

    <!-- TOP BAR -->
    <header class="topbar">
      <div
        class="container-left d-flex align-items-center justify-content-between py-3"
      >
        <div class="fw-bold">AbsensiPro</div>
        <div class="d-flex align-items-center gap-2">
          <button
            id="theme-toggle"
            class="btn-icon"
            aria-label="Ubah tema"
          ></button>
          <button
            class="btn-icon"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#menuOffcanvas"
            aria-label="Menu"
          >
            <i class="bi bi-list"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- MENU -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="menuOffcanvas">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title">Menu</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="offcanvas"
          aria-label="Tutup"
        ></button>
      </div>
      <div class="offcanvas-body">
        <a
          href="admin-dashboard.html"
          class="btn btn-outline-secondary w-100 mb-2"
          ><i class="bi bi-speedometer2 me-2"></i>Admin Dashboard</a
        >
      </div>
    </div>

    <!-- CONTENT -->
    <main class="py-4 py-md-5">
      <div class="container-left">
        <h1 class="title-lg display-6 text-center mb-2">
          Daftar Acara Tersedia
        </h1>
        <p class="subtitle text-center mb-4">
          Silakan pilih acara yang akan Anda hadiri untuk mengisi daftar hadir.
        </p>

        <div id="events-grid" class="events-grid">
          <!-- cards injected -->
        </div>

        <p id="empty" class="subtitle text-center my-4 d-none">
          Belum ada acara aktif.
        </p>
      </div>
    </main>

    <!-- FOOTER (bar biru & sticky) -->
    <footer class="footer-bar">
      <div class="container-left text-center">
        &copy; <span id="year"></span> Diskominfo Hulu Sungai Tengah.
      </div>
    </footer>

    <!-- Libs -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/config.js"></script>

    <script>
      // Tahun
      document.getElementById("year").textContent = new Date().getFullYear();

      // Theme toggle ikon
      const themeBtn = document.getElementById("theme-toggle");
      function syncThemeIcon() {
        const t = document.documentElement.getAttribute("data-theme");
        themeBtn.innerHTML =
          t === "dark"
            ? '<i class="bi bi-sun-fill"></i>'
            : '<i class="bi bi-moon-fill"></i>';
      }
      syncThemeIcon();
      themeBtn.addEventListener("click", () => {
        const cur = document.documentElement.getAttribute("data-theme");
        const next = cur === "dark" ? "light" : "dark";
        document.documentElement.setAttribute("data-theme", next);
        localStorage.setItem("theme", next);
        syncThemeIcon();
      });

      // Supabase (tetap sesuai kode kamu)
      const sb = supabase.createClient(
        window.SUPABASE_URL,
        window.SUPABASE_ANON_KEY
      );

      const $grid = document.getElementById("events-grid");
      const $empty = document.getElementById("empty");

      function fmtDateLong(iso) {
        const d = new Date(iso);
        return d.toLocaleString("id-ID", {
          weekday: "long",
          day: "numeric",
          month: "long",
          year: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function card(ev) {
        const href = `form-kehadiran.html?event=${encodeURIComponent(ev.id)}`;
        const badge =
          ev.status === "active"
            ? '<span class="event-badge badge-active">Aktif</span>'
            : '<span class="event-badge badge-upcoming">Upcoming</span>';

        return `
          <div class="card event-card shadow-sm">
            <div class="card-body d-flex flex-column h-100">
              <div class="d-flex justify-content-between align-items-start mb-1">
                <h5 class="event-title mb-0">${ev.title}</h5>
                ${badge}
              </div>
              <div class="event-meta mb-3">
                <div class="mb-1"><i class="bi bi-calendar-event me-1"></i>${fmtDateLong(
                  ev.datetime
                )}</div>
                ${
                  ev.location
                    ? `<div><i class="bi bi-geo-alt me-1"></i>${ev.location}</div>`
                    : ""
                }
              </div>
              <div class="mt-auto">
                <a class="btn btn-primary w-100" href="${href}">Isi Daftar Hadir</a>
              </div>
            </div>
          </div>`;
      }

      async function loadEvents() {
        // 1) Ambil yang AKTIF dulu (tanggal terbaru desc)
        const a = await sb
          .from("events")
          .select("id,title,datetime,location,status")
          .eq("status", "active")
          .order("datetime", { ascending: false });
        // 2) Lalu UPCOMING (tanggal terbaru desc)
        const u = await sb
          .from("events")
          .select("id,title,datetime,location,status")
          .eq("status", "upcoming")
          .order("datetime", { ascending: false });

        const data = [...(a.data || []), ...(u.data || [])];

        if (!data.length) {
          $grid.innerHTML = "";
          $empty.classList.remove("d-none");
          return;
        }

        $empty.classList.add("d-none");
        $grid.innerHTML = data.map(card).join("");
      }

      loadEvents();
    </script>
  </body>
</html>
